<!DOCTYPE html>
<html lang="ms">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login Futuristik</title>
  <link rel="stylesheet" href="style-Login.css">
</head>

<body>

  <!-- Loader Futuristik -->
  <div id="loadingOverlay">
    <span class="loader"></span>
  </div>

  <div class="login-container-premium">
    <h1 class="title-3d">Selamat Datang</h1>
    <p class="subtitle">Sila log masuk untuk meneruskan</p>
    <form id="loginForm">
      <div class="form-group">
        <input type="text" id="username" required placeholder="Username / Email" class="input-3d-glow">
      </div>
      <div class="form-group">
        <input type="password" id="password" required placeholder="Password" class="input-3d-glow">
      </div>
      <button type="submit" class="button-3d-glow">Log Masuk</button>
    </form>
    <p class="note">© 2026 Sistem Alat Ganti Komputer</p>
  </div>

  <script src="script.js"></script>

  <!--------login firebase auth-->

  <script type="module">
    // 1️⃣ Import SDK Firebase yang diperlukan
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

    // 2️⃣ Config Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAYBhrerG2yfHk-xFna0tLI-QbaVDNaV5M",
      authDomain: "sistem-alat-ganti.firebaseapp.com",
      projectId: "sistem-alat-ganti",
      storageBucket: "sistem-alat-ganti.firebasestorage.app",
      messagingSenderId: "974832583504",
      appId: "1:974832583504:web:2001b035fb35093c252255",
      measurementId: "G-44E4RC3EC8"
    };

    // 3️⃣ Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ===== LOGIN =====
    const loginForm = document.getElementById('loginForm');
    const loadingOverlay = document.getElementById('loadingOverlay');

    function showLoader() { if (loadingOverlay) loadingOverlay.style.display = 'flex'; }
    function hideLoader() { if (loadingOverlay) loadingOverlay.style.display = 'none'; }

    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      showLoader();

      const email = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();

      try {
        // Login user
        const userCred = await signInWithEmailAndPassword(auth, email, password);
        const uid = userCred.user.uid;

        // Ambil role & name dari Firestore
        const snap = await getDoc(doc(db, "users", uid));
        if (!snap.exists()) {
          alert("❌ Role tidak dijumpai di Firestore!");
          return;
        }

        const userData = snap.data();

        // Simpan session
        sessionStorage.setItem("loggedIn", "true");
        sessionStorage.setItem("currentUser", JSON.stringify({
          uid,
          email,
          role: userData.role,
          name: userData.name
        }));

        alert(`✅ Selamat datang, ${userData.name}`);
        window.location.href = "dashboard.html";

      } catch (err) {
        console.error("Login error:", err);
        alert("❌ Email / password salah");
      } finally {
        hideLoader();
      }
    });
  </script>



</body>

</html>